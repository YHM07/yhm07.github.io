---
layout: post
title:  "linux学习笔记十八-linux内核编译及内核裁剪"
keywords: ""
description: ""
category: "linux" 
tags: [linux系统内核编译|linux系统裁剪]
---

# Linux 基础学习笔记十八 -- linux系统裁剪一

@(linux)[linux系统内核编译|linux系统裁剪]

<!-- more -->

## linux内核编译

1. 核心 /boot/vmlinux-version
- 内核模块(ko): /bin/modules/version/
- 内核设计：
		+ 单内核(linux模块化设计)
		+ 微内核(windows)
- 装载模块
		+ insmod
		+ modprobe
- 用户空间访问、监控内核的方式:/proc 或/sys
- 伪文件系统：
		+ /proc/sys 此目录中的文件大部分是可读写的
		+ /sys/ 某些文件可写
- 设定内核参数值的方法
		+ `echo VALUE > /proc/sys/to/somefile `
		+ `sysctl -w kernel.hostname=HOSTNAME`  # 该参数均在**/proc/sys**目录下，每一级目录用一个点替换，能立即生效，无法永久有效
- 永久生效：**/etc/sysctl.conf** 修改该配置文件后并不会立即生效，需要执行`sysctl -p`生效
		+ `sysctl -a` # 显示所有内核参数及其值，比如**drop\_cache hostname ip\_forward**
- 内核模块管理
		+ lsmod # 查看
		+ modprobe MOD-NAME  # 装载模块，不需要指定路径，只需要指定模块名字
		+ modprobe -r MOD-NAME  # 卸载模块
		+ modinfo MOD-NAME # 查看模块的具体信息
		+ insmod  /path/to/module-file     # 装载模块,必须指定路径
		+ rmmod MOD-NAME # 移除模块
		+ depmod /path/to/modfiles-dir 
- 内核中的功能除了核心功能之外,在编译时大多功能有三种选择:
		- 不适用此功能
		- 编译成内核模块
		- 编译进内核

2. 编译内核
- make gconfig # Gnome 桌面环境使用，需要安装图形开发库，GNOME Software Development
- make kconfig # KDE 桌面环境使用，需要安装图形开发库，KDE Software Development
- make menuconfig # 文本环境
- make 
- make modules_install
- make install

3. 二次编译时清理，清理前，如果需要先备份配置文件.config
- make clean
- make mrproper

4. screen命令
- screen -ls 显示已经建立的屏幕
- screen # 直接打开一个新的屏幕
- ctrl+a, d # detached
- screen -r ID # 还原指定ID的屏幕

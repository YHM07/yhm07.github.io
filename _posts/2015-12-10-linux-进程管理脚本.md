---
layout: post
title:  "linux学习笔记十五 -- linux进程管理"
keywords: ""
description: ""
category: "linux" 
tags: [linux进程管理]
---

# Linux 基础学习笔记十五 -- linux进程管理
@(linux)[linux进程管理]

<!-- more -->


# linux进程管理

## shell脚本编程

1. 写一个脚本完成以下功能
	- 说明: 此脚本能于同一个repo文件中创建多个Yum源的指向
	- 接收一个文件名作为参数,此文件存放至/etc/yum.repos.d目录中,且文件名.repo为后缀;要求此文件不能事先存在,否则报错
	- 在脚本中,提醒用户输入repo id; 如果为quit,则退出脚本,否则继续完成以下步骤
	- repo name 以及baseurl的路劲,而后以repo文件的格式将其保存至指定文件中
	- enabled默认为1,而gpgcheck默认设定为0
	- 此脚本会循环执行多次,除非用户为repo id 指定为quit.

```bash 
#!/bin/bash - 

set -o nounset                        # Treat unset variables as an error

if [ -e $1 ]; then 
        echo "the file $1 has exist"
        exit 1
fi

while read -p "input repo id or quit: " ID; do 
        if [ $ID == 'quit' ]; then
                echo "quit"
                exit 0
        fi
        echo "[$ID]" >> $1
        read -p "input baseurl: " baseurl
        echo "baseurl=$baseurl" >> $1
        echo "enabled=1" >> $1
        echo "gpgchack=0" >> $1
done
```

2. 写一个脚本完成以下功能
	- 说明: 此脚本能够为指定网卡创建别名,指定地址,使用格式: mkethalias.sh -v | --verbose -i ethX
	- -i 选项用于指定网卡,指定完成后要判断其是否存在,如果不存在,退出
	- 如果用户指定的网卡存在,则让用户为其指定一个别名,此别名可以为空,请确保其事先不存在,否则报错,并让用户重新输入
	- 在用户输入一个正确的别名后,请用户输入地址和掩码,并将其配置在指定的别名上
	- 如果用户使用了-v选项,则在配置完成后显示其配置结果信息,否则不显示



3. 写一个脚本完成以下功能
	- 提示用户输入一个用户名
	- 显示一个菜单给用户,形如
		* U|u show uid
		* G|g show gid
		* S|s show shell 
		* Q|q quit
	- 提醒用户选择一个选项,并显示其所选择的内容
	- 如果用户给的是一个非上述所提示的选项,则提示用户给出的选项错误,并请其重新选择

```bash
#!/bin/bash - 

set -o nounset                        # Treat unset variables as an error

menu() {
        cat << EOF
        U|u show uid 
        G|g show gid
        S|s show shell 
        Q|q quit
EOF
}

while :; do 
      read -p "Input a username or quit: " USERNAME
      if [ $USERNAME == 'quit' ]; then 
              exit 0
      elif ! id $USERNAME &> /dev/null; then 
              echo "$USERNAME does not exist."
              continue 
      else 
              menu 
              read -p 'Your choice: ' CHOICE
              until [ $CHOICE == 'Q' -o $CHOICE == 'q' ]; do 
                      case $CHOICE in 
                              U|u)
                                      echo "`grep "^$USERNAME" /etc/passwd | awk -F: '{print $3}'`"
                                      ;;
                              G|g)
                                      echo "`grep "^$USERNAME" /etc/passwd | awk -F: '{print $4}'`"
                                      ;;
                              S|s)
                                      echo "`grep "^$USERNAME" /etc/passwd | awk -F: '{print $7}'`"
                                      ;;
                              *)
                                      menu 
                                      read -p 'Your choice, again: ' CHOICE
                                      ;;
                      esac
                      read -p 'Your choice: ' CHOICE
              done 
      fi 
done 
```

4. 写一个脚本完成以下功能
	- 判断一个指定bash脚本是否有语法错误,如果有错误,则提示用户输入Q或q退出脚本,输入其他任意键则通过vim打开该脚本
	- 如果用户通过vim打开编辑后保存退出时仍然有错误,重复上一步,否则正常关闭退出.
	- syntax: ./syntax.sh a.sh (bash -n $1)
	
```bash
\#!/bin/bash - 

set -o nounset                        # Treat unset variables as an error

until bash -n $1 &> /dev/null; do 
        read -p "Your choice: [Q|q] quit, any other key will edit... " CHOICE
        case $CHOICE in 
                Q|q) 
                        echo "maybe somethings wrong"
                        exit 1
                        ;;
                *)
                        vim $1
                        ;;
        esac
done
```

5. 写一个脚本完成以下功能
	- 函数能够接受一个参数,参数为用户名
	- 判断用户是否存在
	- 如果存在就返回用户的shell和UID,并返回正常状态值
	- 如果不存在,就说此用户不存在,并返回错误状态值
	- 扩展:
		* 在主程序中,让用户输自己输入用户名后,传递给函数进行判断
		* 在主程序中,输入用户名判断后不退出脚本,而是提示用户继续输入下一个用户,如果用户不存在,提示用户重新输入,如果输入Q|q,退出脚本.

```bash
#!/bin/bash - 

set -o nounset                        # Treat unset variables as an error

users() {
        if id $1 &> /dev/null; then 
                echo "`grep "$1" /etc/passwd | awk -F: '{print $7, $3}'`"
                return 0
        else
                echo "$1 does not exist"
                return 1
        fi
}

#users user1

read -p "Input a user's name: " USER
until [ $USER == 'Q' -o $USER == 'q' ]; do 
        users $USER 
        if [ $? -ne 0 ]; then 
                read -p "Input a user's name, again: " USER
        else 
                read -p "Input a user's name: " USER
        fi 
done
```

## while 循环

特殊用法一

```bash 
while :; do 
>
done # 死循环
```

特殊用法二

```bash 
while read LINE; do 

 done < /path/to/somefile 
# 通过输入重定向读取文件/path/to/somefile,每次读取一行并赋值给LINE
```
## function

格式一

```bash
function FUNNAME {
	
}
```

格式二

```bash
FUNNAME() {
	
}
```
